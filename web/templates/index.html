{% extends "base.html" %}

{% block title %}Timer{% endblock %}

{% block content %}
<div class="timer-container">
    <!-- Start Day Button -->
    <button class="start-day-btn" id="start-day-btn" onclick="openStartDayModal()">
        <span class="start-day-icon">üåÖ</span>
        <span class="start-day-text">Start Day</span>
        <span class="start-day-hint">Napl√°nuj si den</span>
    </button>

    <!-- ML Recommendation Widget -->
    {% if recommendation %}
    <div class="ml-widget recommendation-widget">
        <div class="widget-icon">&#129504;</div>
        <div class="widget-content">
            <span class="widget-label">Doporuƒçen√Ω preset:</span>
            <span class="widget-value">{{ recommendation.recommended_preset|title }}</span>
            <span class="widget-reason">{{ recommendation.reason }}</span>
        </div>
    </div>
    {% endif %}

    {% if prediction %}
    <div class="ml-widget prediction-widget">
        <div class="widget-icon">&#128200;</div>
        <div class="widget-content">
            <span class="widget-label">Predikce na dnes:</span>
            <span class="widget-value">{{ prediction.predicted_sessions }} sessions</span>
        </div>
    </div>
    {% endif %}

    <!-- Burnout Risk Widget -->
    {% if burnout_risk and burnout_risk.risk_level != 'unknown' %}
    <div class="ml-widget burnout-widget risk-{{ burnout_risk.risk_level }}" id="burnout-widget">
        <div class="widget-icon">&#128293;</div>
        <div class="widget-content">
            <span class="widget-label">Riziko vyho≈ôen√≠:</span>
            <span class="widget-value">{{ burnout_risk.risk_score }}/100</span>
            <span class="widget-risk-badge risk-badge-{{ burnout_risk.risk_level }}">{{ burnout_risk.risk_level|upper }}</span>
        </div>
        <a href="/insights#burnout" class="widget-detail-link" title="Zobrazit detail">&#8594;</a>
    </div>
    {% endif %}

    <!-- Today's Focus Widget -->
    <div class="today-focus-widget" id="today-focus-widget">
        <div class="focus-widget-icon">üéØ</div>
        <div class="focus-widget-content">
            <span class="focus-widget-label">Dne≈°n√≠ zamƒõ≈ôen√≠:</span>
            <span class="focus-widget-theme">{{ today_focus.theme if today_focus and today_focus.theme else 'Nenastaveno' }}</span>
        </div>
        <div class="focus-widget-stats">
            <span class="focus-widget-progress">{{ today_focus.actual_sessions|default(0, true) }}/{{ today_focus.planned_sessions|default(6, true) }}</span>
            <div class="focus-widget-bar">
                <div class="focus-widget-fill" style="width: {{ ((today_focus.actual_sessions|default(0, true)) / (today_focus.planned_sessions|default(6, true)) * 100)|int }}%"></div>
            </div>
        </div>
        <a href="/calendar" class="focus-widget-link" title="Upravit v kalend√°≈ôi">&#9998;</a>
    </div>

    <!-- XP/Level Widget -->
    <div class="level-widget" id="level-widget">
        <div class="level-circle">
            <span class="level-number">{{ user_profile.level|default(1, true) }}</span>
        </div>
        <div class="level-info">
            <span class="level-title">{{ user_profile.title|default('Zacatecnik', true) }}</span>
            <div class="xp-bar">
                <div class="xp-fill" style="width: {{ ((user_profile.xp|default(0, true) - user_profile.current_level_xp|default(0, true)) / (user_profile.next_level_xp|default(100, true) - user_profile.current_level_xp|default(0, true)) * 100)|int }}%"></div>
            </div>
            <span class="xp-text">{{ user_profile.xp|default(0, true) }} / {{ user_profile.next_level_xp|default(100, true) }} XP</span>
        </div>
        <a href="/achievements" class="level-widget-link" title="Zobrazit achievements">&#127942;</a>
    </div>

    <!-- Daily Challenge Widget -->
    {% if daily_challenge %}
    <div class="daily-challenge-widget" id="daily-challenge-widget">
        <div class="challenge-header">
            <span class="challenge-icon">‚öîÔ∏è</span>
            <span class="challenge-label">Denn√≠ v√Ωzva</span>
            {% if daily_challenge.ai_generated %}
            <span class="ai-badge">AI</span>
            {% endif %}
        </div>
        <div class="challenge-content">
            <h4 class="challenge-title">{{ daily_challenge.title|default('Dokonƒçit 4 sessions', true) }}</h4>
            <p class="challenge-desc">{{ daily_challenge.description|default('Spl≈à dne≈°n√≠ c√≠l', true) }}</p>
        </div>
        <div class="challenge-progress">
            <div class="challenge-progress-bar">
                <div class="challenge-progress-fill {% if daily_challenge.completed %}completed{% endif %}"
                     style="width: {{ min((daily_challenge.progress|default(0, true)) / max(1, daily_challenge.target|default(4, true)) * 100, 100)|int }}%"></div>
            </div>
            <span class="challenge-progress-text">{{ daily_challenge.progress|default(0, true) }}/{{ daily_challenge.target|default(4, true) }}</span>
        </div>
        <div class="challenge-footer">
            <span class="challenge-xp-reward">+{{ daily_challenge.xp_reward|default(50, true) }} XP</span>
            {% if daily_challenge.completed %}
            <span class="challenge-completed-badge">‚úì Splnƒõno</span>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Streak Widget with Protection -->
    <div class="streak-widget" id="streak-widget">
        <div class="streak-fire">üî•</div>
        <div class="streak-info">
            <span class="streak-count">{{ streak_status.current_streak|default(0, true) }}</span>
            <span class="streak-label">dn≈Ø v ≈ôadƒõ</span>
        </div>
        {% if streak_status.vacation_mode %}
        <span class="streak-status vacation">üèñÔ∏è Dovolen√°</span>
        {% elif streak_status.protected_today %}
        <span class="streak-status protected">üõ°Ô∏è Chr√°nƒõno</span>
        {% endif %}
        <div class="streak-freezes">
            <span title="Dostupn√© freeze tokeny">‚ùÑÔ∏è {{ streak_status.freezes_available|default(0, true) }}</span>
        </div>
    </div>

    <!-- Focus Optimizer Widget -->
    {% if optimal_schedule and optimal_schedule.peak_hours %}
    <div class="ml-widget focus-optimizer-widget">
        <div class="widget-icon">&#128337;</div>
        <div class="widget-content">
            <span class="widget-label">Optim√°ln√≠ ƒças pro pr√°ci:</span>
            <span class="widget-value">{{ optimal_schedule.summary.best_time_range }}</span>
            <span class="widget-reason">
                {% if optimal_schedule.peak_hours[0] %}
                Teƒè je ide√°ln√≠: {{ optimal_schedule.peak_hours[0].preset_name }} ({{ optimal_schedule.peak_hours[0].expected_productivity|round|int }}% produktivita)
                {% endif %}
            </span>
        </div>
        <a href="/insights#focus-optimizer" class="widget-detail-link" title="Zobrazit rozvrh">&#8594;</a>
    </div>
    {% endif %}

    <!-- Session Quality Prediction Widget -->
    <div class="ml-widget quality-prediction-widget" id="quality-prediction-widget">
        <div class="prediction-score-ring" id="prediction-score-ring">
            <svg viewBox="0 0 80 80">
                <circle class="ring-bg" cx="40" cy="40" r="35" fill="none" stroke-width="6"/>
                <circle class="ring-progress" id="prediction-ring-progress" cx="40" cy="40" r="35"
                        fill="none" stroke-width="6" stroke-linecap="round"
                        stroke-dasharray="219.91" stroke-dashoffset="219.91"
                        transform="rotate(-90 40 40)"/>
            </svg>
            <span class="prediction-score-value" id="prediction-score">--</span>
        </div>
        <div class="prediction-content">
            <span class="prediction-label">Oƒçek√°van√° produktivita</span>
            <div class="prediction-factors" id="prediction-factors">
                <!-- Dynamically populated -->
            </div>
            <div class="prediction-recommendation" id="prediction-recommendation">
                <span class="rec-icon">üí°</span>
                <span class="rec-text">Naƒç√≠t√°m predikci...</span>
            </div>
        </div>
    </div>

    <!-- Preset Selection -->
    <div class="preset-selector">
        {% for key, preset in config.presets.items() %}
        <button class="preset-btn {% if key == config.default_preset %}active{% endif %}"
                data-preset="{{ key }}"
                data-work="{{ preset.work_minutes }}"
                data-break="{{ preset.break_minutes }}"
                style="--preset-color: {{ preset.color }}">
            <span class="preset-icon">
                {% if preset.icon == 'brain' %}&#129504;{% endif %}
                {% if preset.icon == 'book' %}&#128218;{% endif %}
                {% if preset.icon == 'zap' %}&#9889;{% endif %}
                {% if preset.icon == 'waves' %}&#127754;{% endif %}
            </span>
            <span class="preset-name">{{ preset.name }}</span>
            <span class="preset-time">{{ preset.work_minutes }}/{{ preset.break_minutes }}</span>
        </button>
        {% endfor %}
    </div>

    <!-- Timer Display -->
    <div class="timer-display">
        <div class="timer-ring">
            <svg viewBox="0 0 200 200">
                <circle class="timer-ring-bg" cx="100" cy="100" r="90"/>
                <circle class="timer-ring-progress" cx="100" cy="100" r="90" id="progress-ring"/>
            </svg>
            <div class="timer-content">
                <div class="timer-phase" id="timer-phase">WORK</div>
                <div class="timer-time" id="timer-time">52:00</div>
                <div class="timer-session" id="timer-session">Session 1/4</div>
            </div>
        </div>
    </div>

    <!-- Controls -->
    <div class="timer-controls">
        <button class="control-btn" id="btn-start">
            <span class="btn-icon">&#9654;</span>
            Start
        </button>
        <button class="control-btn" id="btn-pause" style="display: none;">
            <span class="btn-icon">&#10074;&#10074;</span>
            Pause
        </button>
        <button class="control-btn secondary" id="btn-reset">
            <span class="btn-icon">&#8635;</span>
            Reset
        </button>
        <button class="control-btn secondary" id="btn-skip">
            <span class="btn-icon">&#9193;</span>
            Skip
        </button>
    </div>

    <!-- Task Input -->
    <div class="task-input-container">
        <select id="category-select" class="task-select">
            {% for cat in config.categories %}
            <option value="{{ cat }}">{{ cat }}</option>
            {% endfor %}
        </select>
        <input type="text" id="task-input" class="task-input" placeholder="Na ƒçem pracuje≈°? (voliteln√©)">
    </div>

    <!-- FocusAI Suggestion Panel -->
    <div id="ai-suggestion-panel" class="ai-suggestion-panel">
        <div class="ai-suggestion-header">
            <span class="ai-icon">üß†</span>
            <span class="ai-title">FocusAI doporuƒçuje</span>
            <button class="ai-refresh-btn" onclick="refreshAISuggestion()" title="Obnovit doporuƒçen√≠">‚Üª</button>
            <button class="ai-close-btn" onclick="hideAISuggestion()" title="Zav≈ô√≠t">√ó</button>
        </div>
        <div class="ai-suggestion-content">
            <div class="ai-suggestion-idle" id="ai-idle">
                <p class="ai-idle-text">Zjisti, na ƒçem bys mƒõl/a pracovat</p>
                <button class="btn-get-suggestion" onclick="loadAISuggestion()">
                    <span>üß†</span> Z√≠skat doporuƒçen√≠
                </button>
            </div>
            <div class="ai-suggestion-loading hidden" id="ai-loading">
                <span class="ai-spinner"></span>
                <span>Analyzuji tvoje data...</span>
            </div>
            <div class="ai-suggestion-result hidden" id="ai-result">
                <div class="suggested-topic">
                    <span class="topic-category" id="ai-category"></span>
                    <span class="topic-name" id="ai-topic"></span>
                </div>
                <p class="topic-reason" id="ai-reason"></p>
                <div class="ai-confidence">
                    <span class="confidence-label">Jistota:</span>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="ai-confidence-bar"></div>
                    </div>
                    <span class="confidence-value" id="ai-confidence-value">--</span>
                </div>
                <div class="ai-suggestion-actions">
                    <button class="btn-use-suggestion" onclick="useSuggestion()">
                        <span>‚úì</span> Pou≈æ√≠t toto t√©ma
                    </button>
                    <button class="btn-different" onclick="loadMoreSuggestions()">
                        <span>‚Üª</span> Jin√Ω n√°pad
                    </button>
                </div>

                <!-- Expand Suggestion Section -->
                <div class="ai-expand-section">
                    <button class="ai-expand-toggle" onclick="toggleExpandSection()">
                        <span class="expand-icon" id="expand-icon">‚ñ∂</span> Chci vƒõdƒõt v√≠c...
                    </button>
                    <div class="ai-expand-buttons hidden" id="expand-buttons">
                        <button class="expand-btn" onclick="expandSuggestion('resources')" title="Dokumentace, tutori√°ly, kurzy">
                            <span>üìö</span> Jak√© zdroje?
                        </button>
                        <button class="expand-btn" onclick="expandSuggestion('steps')" title="Konkr√©tn√≠ kroky co dƒõlat">
                            <span>üéØ</span> Co p≈ôesnƒõ dƒõlat?
                        </button>
                        <button class="expand-btn" onclick="expandSuggestion('time_estimate')" title="Kolik ƒçasu to zabere">
                            <span>‚è±Ô∏è</span> Kolik ƒçasu?
                        </button>
                        <button class="expand-btn" onclick="expandSuggestion('connection')" title="Jak to pom≈Ø≈æe kari√©≈ôe">
                            <span>üîó</span> Proƒç pr√°vƒõ toto?
                        </button>
                    </div>
                    <div class="ai-expand-answer hidden" id="expand-answer">
                        <div class="expand-loading hidden" id="expand-loading">
                            <span class="ai-spinner"></span>
                            <span>P≈ôem√Ω≈°l√≠m...</span>
                        </div>
                        <div class="expand-content" id="expand-content">
                            <div class="expand-header">
                                <span class="expand-icon-result" id="expand-icon-result">üìö</span>
                                <span class="expand-type" id="expand-type">Zdroje</span>
                            </div>
                            <div class="expand-text" id="expand-text"></div>
                            <div class="expand-confidence" id="expand-confidence"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ai-suggestion-error hidden" id="ai-error">
                <span class="error-icon">‚ö†Ô∏è</span>
                <span class="error-text">AI doƒçasnƒõ nedostupn√°</span>
            </div>
        </div>
        <div class="ai-suggestion-footer">
            <span class="ai-cache-status" id="ai-cache-status"></span>
            <a href="/achievements" class="ai-more-link">V√≠ce doporuƒçen√≠ ‚Üí</a>
        </div>
    </div>

    <!-- Keyboard Shortcuts -->
    <div class="shortcuts-hint">
        <span class="shortcut-item"><kbd>Space</kbd> Start/Pause</span>
        <span class="shortcut-item"><kbd>R</kbd> Reset</span>
    </div>

    <!-- Today's Progress -->
    <div class="progress-container">
        <h3>Dne≈°n√≠ pokrok</h3>
        <div class="progress-stats">
            <div class="stat-item">
                <span class="stat-value" id="stat-sessions">{{ today_stats.sessions }}</span>
                <span class="stat-label">sessions</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="stat-hours">{{ today_stats.total_hours }}</span>
                <span class="stat-label">hodin</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="stat-rating">{{ today_stats.avg_rating|default(0, true) }}</span>
                <span class="stat-label">avg rating</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="stat-goal">{{ config.daily_goal_sessions }}</span>
                <span class="stat-label">c√≠l</span>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"
                 style="width: {{ (today_stats.sessions / config.daily_goal_sessions * 100)|int }}%"></div>
        </div>
    </div>
</div>

<!-- Rating Modal -->
<div class="modal-overlay" id="rating-modal" style="display: none;">
    <div class="modal">
        <div class="modal-header">
            <h2>Session dokonƒçena!</h2>
            <p>Jak produktivn√≠ jsi se c√≠til?</p>
        </div>
        <div class="modal-body">
            <!-- Procentu√°ln√≠ zobrazen√≠ -->
            <div class="rating-percentage" id="rating-percentage">0%</div>

            <!-- SVG hvƒõzdy s gradient fill -->
            <div class="rating-stars-svg" id="rating-stars">
                <svg viewBox="0 0 260 50" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <!-- Gradient pro ka≈ædou hvƒõzdu -->
                        <linearGradient id="star-gradient-0" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop class="fill-stop" offset="0%" stop-color="var(--accent-orange, #f59e0b)"/>
                            <stop class="empty-stop" offset="0%" stop-color="var(--text-muted, #666)"/>
                        </linearGradient>
                        <linearGradient id="star-gradient-1" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop class="fill-stop" offset="0%" stop-color="var(--accent-orange, #f59e0b)"/>
                            <stop class="empty-stop" offset="0%" stop-color="var(--text-muted, #666)"/>
                        </linearGradient>
                        <linearGradient id="star-gradient-2" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop class="fill-stop" offset="0%" stop-color="var(--accent-orange, #f59e0b)"/>
                            <stop class="empty-stop" offset="0%" stop-color="var(--text-muted, #666)"/>
                        </linearGradient>
                        <linearGradient id="star-gradient-3" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop class="fill-stop" offset="0%" stop-color="var(--accent-orange, #f59e0b)"/>
                            <stop class="empty-stop" offset="0%" stop-color="var(--text-muted, #666)"/>
                        </linearGradient>
                        <linearGradient id="star-gradient-4" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop class="fill-stop" offset="0%" stop-color="var(--accent-orange, #f59e0b)"/>
                            <stop class="empty-stop" offset="0%" stop-color="var(--text-muted, #666)"/>
                        </linearGradient>
                    </defs>
                    <!-- 5 hvƒõzd - Star path (d = hvƒõzda) -->
                    <path class="star-path" data-star="0" fill="url(#star-gradient-0)"
                          d="M26,2 L32,18 L50,18 L36,28 L41,45 L26,35 L11,45 L16,28 L2,18 L20,18 Z"
                          transform="translate(0, 0)"/>
                    <path class="star-path" data-star="1" fill="url(#star-gradient-1)"
                          d="M26,2 L32,18 L50,18 L36,28 L41,45 L26,35 L11,45 L16,28 L2,18 L20,18 Z"
                          transform="translate(52, 0)"/>
                    <path class="star-path" data-star="2" fill="url(#star-gradient-2)"
                          d="M26,2 L32,18 L50,18 L36,28 L41,45 L26,35 L11,45 L16,28 L2,18 L20,18 Z"
                          transform="translate(104, 0)"/>
                    <path class="star-path" data-star="3" fill="url(#star-gradient-3)"
                          d="M26,2 L32,18 L50,18 L36,28 L41,45 L26,35 L11,45 L16,28 L2,18 L20,18 Z"
                          transform="translate(156, 0)"/>
                    <path class="star-path" data-star="4" fill="url(#star-gradient-4)"
                          d="M26,2 L32,18 L50,18 L36,28 L41,45 L26,35 L11,45 L16,28 L2,18 L20,18 Z"
                          transform="translate(208, 0)"/>
                </svg>
            </div>

            <div class="rating-labels">
                <span>0%</span>
                <span>50%</span>
                <span>100%</span>
            </div>
            <textarea id="session-notes" class="session-notes" placeholder="Pozn√°mky k session (voliteln√©)..." rows="2"></textarea>
        </div>
        <div class="modal-footer">
            <button class="modal-btn secondary" id="rating-skip">P≈ôeskoƒçit</button>
            <button class="modal-btn primary" id="rating-save" disabled>Ulo≈æit</button>
        </div>
    </div>
</div>

<!-- Burnout Warning Modal -->
<div class="modal-overlay" id="burnout-warning-modal" style="display: none;">
    <div class="modal burnout-modal">
        <div class="modal-header burnout-header">
            <div class="burnout-warning-icon">&#9888;</div>
            <h2>Varov√°n√≠: Vysok√© riziko vyho≈ôen√≠</h2>
            <p>Na z√°kladƒõ tv√Ωch vzorc≈Ø pr√°ce detekujeme zv√Ω≈°en√© riziko.</p>
        </div>
        <div class="modal-body">
            <div class="burnout-risk-display">
                <div class="risk-gauge">
                    <div class="risk-gauge-fill" id="modal-risk-gauge"></div>
                    <span class="risk-score" id="modal-risk-score">--</span>
                </div>
                <span class="risk-badge" id="modal-risk-badge">--</span>
            </div>

            <div class="burnout-factors-list" id="modal-burnout-factors">
                <!-- Dynamically populated -->
            </div>

            <div class="burnout-recommendations-list" id="modal-recommendations">
                <!-- Top 2-3 recommendations -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn secondary" id="burnout-ignore">Pokraƒçovat p≈ôesto</button>
            <button class="modal-btn primary" id="burnout-take-break">Vz√≠t si pauzu</button>
        </div>
        <div class="modal-footer-note">
            <a href="/insights#burnout">Zobrazit kompletn√≠ anal√Ωzu &rarr;</a>
        </div>
    </div>
</div>

<!-- Start Day Modal (3-step workflow) -->
<div class="modal-overlay" id="start-day-modal" style="display: none;">
    <div class="modal start-day-modal">
        <!-- Step Indicator -->
        <div class="start-day-steps">
            <div class="step active" data-step="1">
                <span class="step-number">1</span>
                <span class="step-label">Briefing</span>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="2">
                <span class="step-number">2</span>
                <span class="step-label">Pl√°nov√°n√≠</span>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="3">
                <span class="step-number">3</span>
                <span class="step-label">V√Ωzva</span>
            </div>
        </div>

        <!-- Step 1: Morning Briefing -->
        <div class="start-day-step" id="start-day-step-1">
            <div class="modal-header">
                <h2>üåÖ Dobr√© r√°no!</h2>
                <p>Tv≈Øj denn√≠ briefing od FocusAI</p>
            </div>
            <div class="modal-body">
                <div class="briefing-loading" id="briefing-loading">
                    <span class="loading-spinner"></span>
                    <span>Analyzuji tv√° data...</span>
                </div>
                <div class="briefing-content hidden" id="briefing-content">
                    <!-- Yesterday Summary -->
                    <div class="briefing-section">
                        <h4>üìä Vƒçerej≈°√≠ shrnut√≠</h4>
                        <p id="briefing-yesterday">-</p>
                    </div>
                    <!-- Today Prediction -->
                    <div class="briefing-section">
                        <h4>üîÆ Predikce na dnes</h4>
                        <p id="briefing-prediction">-</p>
                    </div>
                    <!-- Focus Recommendation -->
                    <div class="briefing-section">
                        <h4>üéØ Doporuƒçen√≠</h4>
                        <p id="briefing-recommendation">-</p>
                    </div>
                    <!-- Wellbeing -->
                    <div class="briefing-section">
                        <h4>üíö Wellbeing</h4>
                        <p id="briefing-wellbeing">-</p>
                    </div>
                </div>
                <div class="briefing-error hidden" id="briefing-error">
                    <span class="error-icon">‚ö†Ô∏è</span>
                    <span>AI briefing doƒçasnƒõ nedostupn√Ω</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeStartDayModal()">Zru≈°it</button>
                <button class="modal-btn primary" onclick="goToStartDayStep(2)">Dal≈°√≠ ‚Üí</button>
            </div>
        </div>

        <!-- Step 2: Session Planning -->
        <div class="start-day-step hidden" id="start-day-step-2">
            <div class="modal-header">
                <h2>üìã Napl√°nuj si sessions</h2>
                <p>Vyber kategorie a poƒçet sessions na dnes</p>
            </div>
            <div class="modal-body">
                <div class="category-planner" id="category-planner">
                    <!-- Dynamically populated with categories -->
                </div>
                <div class="planning-summary">
                    <span class="summary-label">Celkem napl√°nov√°no:</span>
                    <span class="summary-value" id="total-planned-sessions">0 sessions</span>
                </div>
                <div class="planning-notes">
                    <textarea id="day-notes" placeholder="Pozn√°mky k dne≈°n√≠mu dni (voliteln√©)..." rows="2"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="goToStartDayStep(1)">‚Üê Zpƒõt</button>
                <button class="modal-btn primary" onclick="goToStartDayStep(3)">Dal≈°√≠ ‚Üí</button>
            </div>
        </div>

        <!-- Step 3: Daily Challenge -->
        <div class="start-day-step hidden" id="start-day-step-3">
            <div class="modal-header">
                <h2>‚öîÔ∏è Denn√≠ v√Ωzva</h2>
                <p>P≈ôijmi v√Ωzvu a z√≠skej bonus XP!</p>
            </div>
            <div class="modal-body">
                <div class="challenge-card" id="start-day-challenge">
                    <div class="challenge-card-header">
                        <span class="challenge-card-icon">üéØ</span>
                        <span class="challenge-card-title" id="challenge-title">Naƒç√≠t√°m...</span>
                    </div>
                    <p class="challenge-card-desc" id="challenge-description">-</p>
                    <div class="challenge-card-reward">
                        <span class="reward-label">Odmƒõna:</span>
                        <span class="reward-xp" id="challenge-xp">+50 XP</span>
                    </div>
                    <label class="challenge-accept-checkbox">
                        <input type="checkbox" id="accept-challenge" checked>
                        <span>P≈ôij√≠m√°m v√Ωzvu!</span>
                    </label>
                </div>
                <!-- Streak & Profile Summary -->
                <div class="start-day-summary">
                    <div class="summary-item">
                        <span class="summary-icon">üî•</span>
                        <span class="summary-text">Streak: <strong id="summary-streak">0</strong> dn√≠</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-icon">‚≠ê</span>
                        <span class="summary-text">Level: <strong id="summary-level">1</strong></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="goToStartDayStep(2)">‚Üê Zpƒõt</button>
                <button class="modal-btn primary success" onclick="completeStartDay()">
                    ‚úì Zaƒç√≠t den
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Audio for notifications -->
<audio id="audio-work-end" preload="auto">
    <source src="{{ url_for('static', filename='sounds/work_end.wav') }}" type="audio/wav">
    <source src="{{ url_for('static', filename='sounds/work_end.mp3') }}" type="audio/mpeg">
</audio>
<audio id="audio-break-end" preload="auto">
    <source src="{{ url_for('static', filename='sounds/break_end.wav') }}" type="audio/wav">
    <source src="{{ url_for('static', filename='sounds/break_end.mp3') }}" type="audio/mpeg">
</audio>
<audio id="audio-burnout-warning" preload="auto">
    <source src="{{ url_for('static', filename='sounds/burnout_warning.wav') }}" type="audio/wav">
    <source src="{{ url_for('static', filename='sounds/burnout_warning.mp3') }}" type="audio/mpeg">
</audio>
{% endblock %}

{% block extra_js %}
<script>
    // Pass config to JavaScript
    const CONFIG = {{ config | tojson | safe }};
    const TODAY_STATS = {{ today_stats | tojson | safe }};
    const BURNOUT_RISK = {{ burnout_risk | tojson | safe if burnout_risk else 'null' }};

    // Gamification data
    const USER_PROFILE = {{ user_profile | tojson | safe if user_profile else '{}' }};
    const DAILY_CHALLENGE = {{ daily_challenge | tojson | safe if daily_challenge else 'null' }};
    const STREAK_STATUS = {{ streak_status | tojson | safe if streak_status else '{}' }};
</script>
{% endblock %}
